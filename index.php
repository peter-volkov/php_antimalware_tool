<?php

require_once('classes/Localization.inc.php');
require_once('classes/View.inc.php');

//////////////////////////////////////////////////////////////////////////////
// file_put_contents replacement
//////////////////////////////////////////////////////////////////////////////
function file_put_contents2($filename, $data, $die_on_err = true) {
  $f = fopen($filename, 'w');
  if (!$f) {
      if ($die_on_err) {

         $err = error_get_last();
         die(sprintf(PS_ERR_CANNOT_CREATE_FILE, $filename, $err['message']));
      }

      return false;
  } else {
      $bytes = fwrite($f, $data);
      fclose($f);
      return $bytes;
  }
}

//////////////////////////////////////////////////////////////////////////////

$project_root_dir = dirname(__FILE__);
$project_folder = substr($_SERVER['SCRIPT_NAME'], 0, strpos($_SERVER['SCRIPT_NAME'],basename($_SERVER['SCRIPT_NAME'])));
$project_tmp_dir = '.';


if (!is_writable($project_tmp_dir)) {
   header("Content-type: text/html; charset=utf-8");
   die(PS_ERR_NO_TEMP_FOLDER);
}

if (empty($_REQUEST['controller']) || $_REQUEST['controller'] == 'scanner') {

	require_once('classes/ScannerController.inc.php');

	$scannerController = new ScannerController();
	$scannerController->start();

} else if ( $_REQUEST['controller'] == 'executor' ) {

	require_once('classes/ExecutorController.inc.php');

	$executorController = new ExecutorController();
	$executorController->start();

} else if ( $_REQUEST['controller'] == 'download' ) {

	require_once('classes/DownloadController.inc.php');

	$downloadController = new DownloadController();
	$downloadController->start();

} else if ( $_REQUEST['controller'] == 'help' ) {
         $view = new View();
         define('PS_PATH', $project_folder);
         $view->display("help.tpl");
}
