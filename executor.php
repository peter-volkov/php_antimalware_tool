<?php

require_once("classes/FileInfo.inc.php");
require_once("classes/Healer.inc.php");
require_once("classes/View.inc.php");
require_once("classes/XmlValidator.inc.php");


if (!empty($_POST) && !empty($_POST["recipe"])) 
{
    $healer = new Healer();
    $xml_recipe = $_POST["recipe"];
   
    $validator = new XmlValidator();
    if (!$validator->validate($xml_recipe, "/static/xsd/recipe.xsd")) {
        die('xml is broken');
    }
    
    $view = new View("/static/templates/");
    $view->set("title", "Result");
    $view->set("result", $healer->execute_xml_recipe($xml_recipe));
    $view->set("quarantine_url", $healer->get_quarantine_filename());
    $view->display("executor_result.tpl");

} else {

    $view = new View("/static/templates/");
    $view->display("executor_recipe_form.tpl");

}