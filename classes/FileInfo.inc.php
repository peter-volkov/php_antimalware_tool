<?php

class FileInfo {
    public function __construct($file_path) {

        $this->web_root_dir = $_SERVER['DOCUMENT_ROOT'] ;
        $this->getInfoByName($file_path);
        $this->max_scan_file_size = 2097152;
    }
    public function getInfoByName($file_path) {
        if (file_exists($file_path)) {     
            $this->absolute_name = $file_path;
            $this->name = str_replace($this->web_root_dir, '.', $file_path);;
            $this->ctime = filectime($file_path);
            $this->mtime = filemtime($file_path);
            $this->owner = fileowner($file_path);
            $this->access = fileperms($file_path);
            if (is_file($file_path)) {
                $this->size = filesize($file_path);
                if ($this->size < $this->max_scan_file_size) {
                    #$this->crc32 = hash_file('crc32b', $file_path);
                    #$this->crc32b = hash_file('crc32', $file_path);
                    $this->md5 = hash_file('md5', $file_path);
                    #$this->md2 = hash_file('md2', $file_path);
                }  else {
                    $this->crc32 = 0;
                    $this->crc32b = 0;
                    $this->md5 = 0;
                    $this->md2 = 0;
                }
                 
            } else {
                $this->size = 0;
                $this->crc32 = 0;
                $this->crc32b = 0;
                $this->md5 = 0;
                $this->md2 = 0;
            }
       	} else die(PS_ERR_NO_SUCH_FILE);

        return true;
    }

    public function getXMLNode() {
        $dom = new DOMDocument("1.0", "utf-8");
        $fileinfo_node = $dom->createElement("file");
        $fileinfo_node->appendChild($dom->createElement("path", $this->name));
        $fileinfo_node->appendChild($dom->createElement("size", $this->size));
        $fileinfo_node->appendChild($dom->createElement("ctime", $this->ctime));
        $fileinfo_node->appendChild($dom->createElement("mtime", $this->mtime));
        $fileinfo_node->appendChild($dom->createElement("owner", $this->owner));
        $fileinfo_node->appendChild($dom->createElement("access", $this->access));
        #$fileinfo_node->appendChild($dom->createElement("crc32b", $this->crc32b));
        #$fileinfo_node->appendChild($dom->createElement("crc32", $this->crc32));
        $fileinfo_node->appendChild($dom->createElement("md5", $this->md5));
        #$fileinfo_node->appendChild($dom->createElement("md2", $this->md2));
        $dom->appendChild($fileinfo_node);
        return $dom->getElementsByTagName("file")->item(0);
    }
    public function __toString() {
        $data = array($this->name, $this->size, $this->ctime, $this->mtime, $this->owner, $this->access, $this->crc32b, $this->crc32, $this->md5, $this->md2);
        return implode(';', $data);
    }
}
