<?php
class WebServerEnvInfo {
    public function __construct() {
        $this->script_filename = $_SERVER["SCRIPT_FILENAME"];
        $this->document_root = $_SERVER["DOCUMENT_ROOT"];
        $this->http_host = $_SERVER["HTTP_HOST"];
        $this->admin_email = $_SERVER["SERVER_ADMIN"];
        $this->time = date("Y.m.d H:i:s", $_SERVER["REQUEST_TIME"]);
        $this->server_addr = $_SERVER["SERVER_ADDR"];
        $this->server_software = $_SERVER["SERVER_SOFTWARE"];
        $this->server_gateway = $_SERVER["GATEWAY_INTERFACE"];
        $this->server_signature = $_SERVER["SERVER_SIGNATURE"];
        $this->server_hostname = @php_uname('n');
        $this->server_platform = @php_uname('s') . " " . @php_uname('r') . " " . @php_uname('v');
        $this->server_architecture = @php_uname('m');
        $this->username = "uid: " . @getmyuid() . ", gid: " . @getmygid();
        $this->pathinfo = getcwd();
        // get phpinfo
        ob_start();
        ob_clean();
        phpinfo();
        $phpinfo = ob_get_contents();
        ob_clean();
        // clean up from
        $phpinfo = str_replace('border: 1px', '', $phpinfo);
        preg_match('|<body>(.*)</body>|smiu', $phpinfo, $pure_data);
        $pure_data[1] = str_replace(" class=\"e\"", '', $pure_data[1]);
        $pure_data[1] = str_replace(" class=\"v\"", '', $pure_data[1]);
        $pure_data[1] = str_replace("&nbsp;", ' ', $pure_data[1]);
        $pure_data[1] = preg_replace("|<font.+?>.+?</font>|smiu", '', $pure_data[1]);
        $this->phpinfo = $pure_data[1];
    }
    public function getXMLNode() {
        $dom = new DOMDocument("1.0", "utf-8");
        $server_env_node = $dom->createElement("server_environment");
        $server_env_node->appendChild($dom->createElement("script_filename", $this->script_filename));
        $server_env_node->appendChild($dom->createElement("document_root", $this->document_root));
        $server_env_node->appendChild($dom->createElement("http_host", $this->http_host));
        $server_env_node->appendChild($dom->createElement("admin_email", $this->admin_email));
        $server_env_node->appendChild($dom->createElement("time", $this->time));
        $server_env_node->appendChild($dom->createElement("server_addr", $this->server_addr));
        $server_env_node->appendChild($dom->createElement("software", $this->server_software));
        $server_env_node->appendChild($dom->createElement("server_gateway", $this->server_gateway));
        $server_env_node->appendChild($dom->createElement("server_signature", $this->server_signature));
        $server_env_node->appendChild($dom->createElement("server_hostname", $this->server_hostname));
        $server_env_node->appendChild($dom->createElement("platform_name", $this->server_platform));
        $server_env_node->appendChild($dom->createElement("server_architecture", $this->server_architecture));
        $server_env_node->appendChild($dom->createElement("username", $this->username));
        $server_env_node->appendChild($dom->createElement("path", $this->pathinfo));
        $server_env_node->appendChild($dom->createElement("phpinfo", $this->phpinfo));
        $dom->appendChild($server_env_node);
        return $dom->getElementsByTagName("server_environment")->item(0);
    }
    public function __toString() {
        $data = array($this->script_filename, $this->document_root, $this->http_host, $this->admin_email, $this->time);
        return implode(';', $data);
    }
}
